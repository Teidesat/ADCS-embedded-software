// acubesat

#include "../lib/hardware/INS/INS.hpp"
#include "../lib/algorithms/acubesat/acubesat.hpp"

unsigned long lastUpdate;

INS ins;
Acubesat acubesatAlgorithm;

void setup() {
  lastUpdate = micros();

  ins.begin();
  acubesatAlgorithm.setupForOnlyGyro();
}

void loop() {
  unsigned long now = micros();
  float deltaTime = (now - lastUpdate) / 1e6f;  // convert µs → seconds

  ins.update();
  acubesatAlgorithm.predict(ins.getIMU().getGyroscopes().x, ins.getIMU().getGyroscopes().y, ins.getIMU().getGyroscopes().z, 0.01);
  //Serial.println(ins.gnss.getLastNMEAmessage().c_str());
  Serial.println(String(acubesatAlgorithm.pitch) + " " + String(acubesatAlgorithm.roll) + " " + String(acubesatAlgorithm.yaw));
  //Serial.println(String(ins.getIMU().getGyroscopes().x) + " " + String(ins.getIMU().getGyroscopes().y) + " " + String(ins.getIMU().getGyroscopes().z));
  lastUpdate = now;
}