// reefwing

#include "../lib/hardware/INS/INS.hpp"
#include "../lib/algorithms/ReefwingAHRS/ReefwingAHRS.hpp"

//  reefwingAHRS library has own implementation of lsm9ds1 object
ReefwingAHRS imu;


void setup() {
  setupHardware();
  imu.begin(); // using madgwick
}

void loop() {
  IMUdata imuRawValues = readSensors();
  IMUSensors imuVector3d;
  imuVector3d.ax = imuRawValues.getAccelerometers().x;
  imuVector3d.ay = imuRawValues.getAccelerometers().y;
  imuVector3d.az = imuRawValues.getAccelerometers().z;
  imuVector3d.gx = imuRawValues.getGyroscopes().x;
  imuVector3d.gy = imuRawValues.getGyroscopes().y;
  imuVector3d.gz = imuRawValues.getGyroscopes().z;
  imuVector3d.mx = imuRawValues.getMagnetometers().x;
  imuVector3d.my = imuRawValues.getMagnetometers().y;
  imuVector3d.mz = imuRawValues.getMagnetometers().z;

  imu.setData(imuVector3d);
  imu.update();

  String attitude = String(imu.angles.pitch) + ',' + String(imu.angles.roll);
  Serial.println(attitude);
}