// arduino-library

#include "../lib/hardware/INS/INS.hpp"
#include "../lib/algorithms/arduino_library/arduino_library.hpp"

// LSM9DS1 object and upsat algorithm structs
ArduinoLibMadgwick arduinoLibMadgwick;


void setup() {
  // set up sensors and upsat algorithm main struct
  setupHardware();
}

void loop() {
  // get data from sensors
  IMUdata imuRawValues = readSensors();
  String rawDataStr = formatIMUvalues(imuRawValues);

  // calculate attitude using madgwick algorithm
  arduinoLibMadgwick.update(imuRawValues.getGyroscopes().x, imuRawValues.getGyroscopes().y, imuRawValues.getGyroscopes().z, imuRawValues.getAccelerometers().x, imuRawValues.getAccelerometers().y, imuRawValues.getAccelerometers().z, imuRawValues.getMagnetometers().x, imuRawValues.getMagnetometers().y, imuRawValues.getMagnetometers().z);
  
  Attitude currentAttitudeRawRadians = fillAttitudeValues(arduinoLibMadgwick.getPitch(), arduinoLibMadgwick.getRoll(), arduinoLibMadgwick.getYaw());
  Attitude currentAttitudeRawDegrees = convertAttitudeRadiansToDegrees(currentAttitudeRawRadians);
  String attitudeRawDegreesStr = formatAttitudeValues(currentAttitudeRawRadians);
  String pitchAndRollRawDegreesStr = formatPitchandRoll(currentAttitudeRawRadians);

  // print pith, roll and yaw
  Serial.println(pitchAndRollRawDegreesStr);
} 